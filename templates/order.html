{% extends 'base.html' %}

{% block title %}
<title>Order</title>
{% endblock title %}

{% block css %}
<style>
    .divider {
        height: 1px;
        overflow: hidden;
        background-color: #e0e0e0;
    }

    .leftcart {
        position: sticky;
        height: 650px;
        border: 6px solid white;
        top: 80px;
        overflow: auto;
    }

    .body {
        scroll-behavior: smooth;
    }

    div.scrollmenu {
        text-align: center;
        overflow: auto;
        white-space: nowrap;
    }

    .scrollmenu a {
        color: rgb(145, 84, 84);
        font-size: 17px;
        padding-left: 1.9rem;
        text-transform: uppercase;

    }

    .scrollmenu a:hover {
        transition: all 0.4s;
        color: rgb(20, 9, 9);
        padding-left: 2.2rem;

    }

    .menu_heading {
        font-size: 18px;
        color: black;
        font-family: Georgia, 'Times New Roman', Times, serif;
    }

    .menu_title {
        font-size: 26px;
        font-weight: bold;
        color: #4c4b4b;
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif
    }
</style>

{% endblock css %}

{% block body %}

{% load static %}

<div class="row ">
    <div class="col-md-3 order-2 leftcart shadow" style="margin-left: 7rem;">
        <aside id="sidecart"> </aside>
    </div>

    <div class="col-md-7 order-1 offset-1 ">

        <!--  start of Scroll Bar -->
        <div class="shadow scrollmenu  p-3 mb-5 bg-white rounded "
            style="position: sticky; top: 80px; margin-top: 8rem;">
            <a href="#pizza"> Pizza </a>
            <a href="#Burgers"> Burgers </a>
            <a href="#SP"> Shawarma & Platter </a>
            <a href="#Appetizer"> Appetizers </a>
            <a href="#Sandwiches"> Sandwiches</a>
            <a href="#PR"> Pasta & Rolls </a>
        </div>
        <!--  End of Scroll Bar -->

        <!-- ------------ Start of pizza -------------------- -->

        <div class="d-flex justify-content-center mt-2" id="pizza">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">

            <p class="menu_title pl-4 pr-4"> Pizza </p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in piza  %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">
                <!-- https://source.unsplash.com/40x40/?pizza -->

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="namepr{{i.id}}"> {{i.Name}} </span>

                        <div> Rs <span id="pricepr{{i.id}}"> {{i.Price}} </span> </div>

                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divpr{{i.id}}" class="divpr">
                            <button id="pr{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                        <!-- <button type="button" class="btn btn-dark btn-sm">Add to cart</button> -->
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <!-- ------------ End of pizza -------------------- -->


        <!-- ------------ Start of Burger -------------------- -->

        <div class="d-flex justify-content-center mt-2" id="Burgers">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">

            <p class="menu_title pl-4 pr-4"> BURGER </p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in burger  %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">
                <!-- https://source.unsplash.com/40x40/?pizza -->

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="namebrger{{i.id}}"> {{i.Name}} </span>

                        <div> Rs <span id="pricebrger{{i.id}}"> {{i.Price}} </span> </div>

                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divbrger{{i.id}}" class="divpr">
                            <button id="brger{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                    </div>
                </div>
            </div>

            {% endfor %}


        </div>

        <!-- ------------ End of  Burger -------------------- -->


        <!-- ------------ Start of Shawarma & Platter-------------------- -->

        <div class="d-flex justify-content-center mt-2" id="SP">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">

            <p class="menu_title pl-4 pr-4"> Shawarma & Platter </p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in shawarma_pltr %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">
                <!-- https://source.unsplash.com/40x40/?pizza -->

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="nameshwar{{i.id}}"> {{i.Name}} </span>

                        <div> Rs <span id="priceshwar{{i.id}}"> {{i.Price}} </span> </div>

                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divshwar{{i.id}}" class="divpr">
                            <button id="shwar{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                    </div>
                </div>

            </div>

            {% endfor %}


        </div>

        <!-- ------------ End of  Shawarma & Platter -------------------- -->


        <!-- ------------ Start of Appetizers  -------------------- -->

        <div class="d-flex justify-content-center mt-2" id="Appetizer">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">

            <p class="menu_title pl-4 pr-4"> Appetizer</p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in appetizer %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">
                <!-- https://source.unsplash.com/40x40/?pizza -->

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="nameapitzr{{i.id}}"> {{i.Name}} </span>

                        <div> Rs <span id="priceapitzr{{i.id}}"> {{i.Price}} </span> </div>

                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divapitzr{{i.id}}" class="divpr">
                            <button id="apitzr{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                    </div>
                </div>

            </div>

            {% endfor %}


        </div>

        <!-- ------------ End of  Appetizers  -------------------- -->


        <!-- ------------ Start of Sandwiches -------------------- -->

        <div class="d-flex justify-content-center mt-2" id="Sandwiches">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">


            <p class="menu_title pl-4 pr-4"> Sandwiches</p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in sandwiche %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="namesand{{i.id}}"> {{i.Name}} </span>

                        <div> Rs <span id="pricesand{{i.id}}"> {{i.Price}} </span> </div>

                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divsand{{i.id}}" class="divpr">
                            <button id="sand{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                    </div>
                </div>

            </div>

            {% endfor %}


        </div>

        <!-- ------------ End of  Sandwiches-------------------- -->


        <!-- ------------ Start of Pasta & Rolls   -------------------- -->

        <div class="d-flex justify-content-center mt-2" id="PR">
            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2 " width="70"
                height="15" alt="Loading....">

            <p class="menu_title pl-4 pr-4"> Pasta & Rolls</p>

            <img src="{% static 'Pizza/dots.png' %}" class="bd-placeholder-img  mr-2 rounded mt-2" width="70"
                height="15" alt="Loading....">
        </div>


        <div class=" p-3 bg-white rounded shadow-sm container my-5">
            {% for i in pasta_Roll %}
            <div class="media text-muted pt-3 " style="margin-right: 4rem;">
                <img src="/media/{{i.img}}" class="bd-placeholder-img  mr-2 rounded" width="40" height="40"
                    alt="Loading....">
                <!-- https://source.unsplash.com/40x40/?pizza -->

                <div class="media-body pb-4 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between  w-100 menu_heading">
                        <span id="namepasta{{i.id}}"> {{i.Name}} </span>
                        <div> Rs <span id="pricepasta{{i.id}}"> {{i.Price}} </span> </div>
                    </div>

                    <div class="d-flex justify-content-end mt-2">
                        <span id="divpasta{{i.id}}" class="divpr">
                            <button id="pasta{{i.id}}" class="btn btn-dark btn-sm cart">Add To Cart</button>
                        </span>
                    </div>
                </div>

            </div>

            {% endfor %}


        </div>

        <!-- ------------ End of  Pasta & Rolls -------------------- -->

    </div>
</div>
{% endblock body %}


{% block js %}
<script>

    // Find out the cart items from localStorage
    if (localStorage.getItem('cart') == null) {
        var cart = {};
    } else {
        cart = JSON.parse(localStorage.getItem('cart'));
        updateCart(cart);

    }
    // If the add to cart button is clicked, add/increment the item

    $('.divpr').on('click', 'button.cart', function () {
        var idstr = this.id.toString();
        console.log(idstr);
        if (cart[idstr] != undefined) {
            qty = cart[idstr][0] + 1;
        } else {
            qty = 1;
            name = document.getElementById('name' + idstr).innerHTML;
            price = document.getElementById('price' + idstr).innerHTML;
            cart[idstr] = [qty, name, parseInt(price)]
        }
        updateCart(cart);
    });

    function clearCart() {
        cart = JSON.parse(localStorage.getItem('cart'));
        for (var item in cart) {
            console.log(item);
            document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-dark btn-sm cart">Add To Cart</button>'
        }
        localStorage.clear();
        cart = {};
        updateCart(cart);
        console.log(cart);
    }

    function updatePopover(cart) {
        var popStr = "";

        if ($.isEmptyObject(cart)) 
        {
            //if object is empty
            popStr = "<h4 class = 'text-center my-4 text-success'> Your Cart is empty </h4> "
            document.getElementById('sidecart').innerHTML = popStr;
        }
        else 
        {
        let total_price = 0
        popStr = popStr + " <h4 class = 'text-center my-4 text-success'> Your Cart </h4> ";
        for (var item in cart) {
            let qty = cart[item][0];
            let name = cart[item][1];
            let price = cart[item][2];
            let price2 = price * qty;
            total_price += price2;
            popStr = popStr + `<div class='d-flex justify-content-between my-2 mr-2 py-2 h6'> <div> ${qty} x  ${name} </div>   <div  class = 'ml-5'>  ${price2}  </div> </div>         
            <div class='divider'> </div> `;
        }
        popStr = popStr + `<div class='d-flex justify-content-between mx-2 my-2 py-2 h6'> <div class='text-success'> Total </div>  <strong>${total_price}</strong> </div> 
            <div class='divider'> </div>  `;
        popStr = popStr + "<a href='/checkout' class='my-4 btn btn-success btn-sm btn-block'> Checkout </a> ";
        popStr = popStr + " <button onclick='clearCart()' class='btn btn-dark btn-block'>ClearCart</button>";

        document.getElementById('sidecart').innerHTML = popStr;
         }
    }

    function updateCart(cart) {
        var sum = 0;
        for (var item in cart) {
            sum = sum + cart[item][0];
            document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-dark minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-dark plus'> + </button>";
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById('cart').innerHTML = sum;
        console.log(cart);
        updatePopover(cart);
    }

    // If plus or minus button is clicked, change the cart as well as the display value

    $('.divpr').on("click", "button.minus", function () {
        a = this.id.slice(5,);
        cart[a][0] = cart[a][0] - 1;
        cart[a][0] = Math.max(1, cart[a][0]);
        document.getElementById('val' + a).innerHTML = cart[a][0];
        updateCart(cart);
    });

    $('.divpr').on("click", "button.plus", function () {
        a = this.id.slice(4,);
        cart[a][0] = cart[a][0] + 1;
        document.getElementById('val' + a).innerHTML = cart[a][0];
        updateCart(cart);
    });

</script>

{% endblock %}